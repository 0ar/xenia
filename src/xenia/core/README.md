TODO(benvanik): remove all of this code.

* hash can be moved to util/
* ref can be removed when run_loop is rewritten
* run_loop should be moved to ui/ (perhaps)
* socket can be moved to poly
